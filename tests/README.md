# 마음지기 OpenAI API 테스트

## 테스트 실행 방법

### 1. 환경 설정
```bash
# .env.local 파일에 OpenAI API 키 설정
OPENAI_API_KEY="sk-..."
NEXTAUTH_SECRET="your-secret"
NEXTAUTH_URL="http://localhost:5000"
```

### 2. 개발 서버 실행
```bash
npm run dev
```

### 3. 테스트 실행

#### 방법 A: Node.js로 직접 실행
```bash
npx ts-node tests/chat-api.test.ts
```

#### 방법 B: 브라우저에서 수동 테스트
1. http://localhost:5000 접속
2. 이메일로 회원가입/로그인 또는 익명 체험
3. 채팅 페이지에서 다음 테스트:

**기본 대화:**
```
오늘 상사한테 혼났어요. 너무 화가 나요.
```

**대화 맥락 유지:**
```
1번째: 오늘 중요한 프레젠테이션이 있어요.
2번째: 아까 말한 그 프레젠테이션, 망했어요 ㅠㅠ
```
→ AI가 이전 대화를 기억하는지 확인

**위기 상황 감지:**
```
더 이상 못 살겠어요. 죽고 싶어요.
```
→ 1393 자살예방 상담 번호가 표시되는지 확인

**감정 분류:**
```
오늘 승진 소식 들었어요! 너무 기뻐요!
```
→ 대시보드에서 "기쁨" 감정으로 분류되는지 확인

## 예상 결과

### ✅ 올바른 AI 응답 예시
```
정말 힘들었겠다. 상사한테 혼나면 기분이 정말 안 좋지.
오늘은 그냥 일찍 퇴근해서 좋아하는 거 하는 게 어때? 💙
내일은 더 나은 날이 될 거야.
```

### ❌ 잘못된 AI 응답 예시
```
귀하의 상황을 이해합니다. 상사와의 갈등은 직장 생활에서 
흔히 발생하는 문제입니다. 다음과 같은 대처 방법을 추천드립니다:
1. 심호흡을 하며 감정을 가라앉히세요.
2. 상사의 입장에서 생각해보세요.
3. 필요시 HR 부서에 상담을 요청하세요.
... (너무 길고 형식적)
```

## 체크리스트

- [ ] AI 응답이 2-4문장으로 간결함
- [ ] 반말 사용 ("~해", "~지", "~구나")
- [ ] 이모지 적절히 사용 💙
- [ ] 대화 맥락 유지 (최근 5개 메시지)
- [ ] 위기 상황 시 1393 번호 제공
- [ ] 감정 분류 정확도 (joy/sadness/anger/anxiety/stress)
- [ ] 스트리밍 응답 (타이핑 효과)
- [ ] 에러 처리 (API 키 없음, 타임아웃)
- [ ] 로딩 상태 표시

## 성능 테스트

### 응답 시간
- 첫 토큰: ~1-2초
- 전체 응답: ~3-5초
- 타임아웃: 30초

### Rate Limiting
- 무료: 하루 3회
- 프리미엄: 무제한

## 문제 해결

### OpenAI API 키 에러
```
Error: OPENAI_API_KEY가 설정되지 않았습니다.
```
→ .env.local 파일 확인

### 타임아웃 에러
```
Error: 응답 시간이 초과되었어요.
```
→ 네트워크 연결 확인 또는 잠시 후 재시도

### Rate Limit 에러
```
오늘의 무료 대화 횟수를 모두 사용했어요.
```
→ 프리미엄 구독 또는 내일 다시 시도
